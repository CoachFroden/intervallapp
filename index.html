<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Intervall App</title>

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0b1e3d">

    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(180deg, #0b1e3d, #0d335f, #1a4c7e);
            color: white;
            text-align: center;
            padding: 20px;
            margin: 0;
            overflow-y: auto; /* Viktig – gjør at mobilen kan scrolle */
        }

        h1 {
            font-size: 38px;
            margin-bottom: 5px;
            text-shadow: 0 0 12px rgba(150,200,255,0.9);
        }

        h2 {
            margin-top: 0;
            font-weight: normal;
            color: #cde6ff;
            text-shadow: 0 0 10px rgba(180,220,255,0.8);
        }

        #display {
            font-size: 70px;
            margin-top: 25px;
            margin-bottom: 10px;
            text-shadow: 0 0 25px rgba(255,255,255,0.7);
        }

        #sub {
            font-size: 26px;
            opacity: 0.85;
            margin-bottom: 30px;
        }

        .controls {
            margin-top: 25px;
        }

        button {
            padding: 12px 25px;
            margin: 8px;
            font-size: 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        .start-btn { background: #2ecc71; }
        .stop-btn { background: #e74c3c; }
        .pause-btn { background: #f1c40f; }

        input {
            width: 90px;
            padding: 8px;
            font-size: 18px;
            margin: 5px;
            border-radius: 6px;
            border: none;
            text-align: center;
        }
    </style>
</head>

<body>

<h1>Intervall App</h1>
<h2>Vintertrening 2026 ❄️</h2>

<div>
    <label>Arbeid (sek): </label>
    <input id="workInput" type="number" value="30"><br>

    <label>Pause (sek): </label>
    <input id="restInput" type="number" value="15"><br>

    <label>Runde-pause (sek): </label>
    <input id="roundPauseInput" type="number" value="60"><br>

    <label>Antall stasjoner: </label>
    <input id="stationsInput" type="number" value="10"><br>

    <label>Antall runder: </label>
    <input id="roundsInput" type="number" value="3"><br>
</div>

<div id="display">00</div>
<div id="sub"></div>

<div class="controls">
    <button class="start-btn" onclick="startInterval()">Start</button>
    <button class="pause-btn" onclick="pauseInterval()">Pause</button>
    <button class="stop-btn" onclick="stopInterval()">Stopp</button>
</div>

<!-- Lydfiler -->
<audio id="startSound" src="start.wav"></audio>
<audio id="beep321" src="beep.mp3"></audio>
<audio id="stationEnd" src="langbeep.mp3"></audio>
<audio id="roundEnd" src="endbuzzer.wav"></audio>

<script>
let workTime, restTime, roundPauseTime, stations, rounds;
let currentStation = 1;
let currentRound = 1;

let timeLeft = 0;
let mode = "idle"; 
let timerInterval = null;

// ------------- HJELPEFUNKSJONER -----------------
function playBeep321(sec) {
    if (sec <= 3 && sec > 0) {
        beep321.play();
    }
}

// ------------- START -----------------
function startInterval() {

    startSound.play();

    startSound.onended = () => {
        workTime = Number(workInput.value);
        restTime = Number(restInput.value);
        roundPauseTime = Number(roundPauseInput.value);
        stations = Number(stationsInput.value);
        rounds = Number(roundsInput.value);

        currentStation = 1;
        currentRound = 1;

        timeLeft = workTime;
        mode = "work";

        updateDisplay();

        if (timerInterval) clearInterval(timerInterval);
        timerInterval = setInterval(tick, 1000);
    };
}

// ------------- PAUSE -----------------
function pauseInterval() {
    if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
    }
}

function stopInterval() {
    clearInterval(timerInterval);
    timerInterval = null;
    mode = "idle";
    display.innerText = "00";
    sub.innerText = "";
}

// ------------- TICK -----------------
function tick() {
    if (mode === "idle") return;

    timeLeft--;
    updateDisplay();

    playBeep321(timeLeft);

    // Når tiden er ferdig i en hvilken som helst modus:
    if (timeLeft <= 0) {
        handleTransition();
    }
}

// ------------- OPPDATER SKJERM -----------------
function updateDisplay() {
    display.innerText = timeLeft;
    sub.innerHTML = `${modeText()}<br>Runde ${currentRound}/${rounds} &nbsp; | &nbsp; Stasjon ${currentStation}/${stations}`;
}

function modeText() {
    if (mode === "work") return "Arbeid";
    if (mode === "rest") return "Pause";
    if (mode === "roundPause") return "Runde-pause";
    return "";
}

// ------------- HVA SKJER NÅR EN TID ER FERDIG -----------------
function handleTransition() {

    if (mode === "work") {

        // Var dette siste stasjon i runden?
        if (currentStation < stations) {

            // Vanlig stasjon ferdig
            stationEnd.play();

            mode = "rest";
            timeLeft = restTime;
            currentStation++;

        } else {

            // Siste stasjon → Runden er ferdig
            roundEnd.play();

            currentRound++;

            if (currentRound > rounds) {
                stopInterval();
                return;
            }

            mode = "roundPause";
            timeLeft = roundPauseTime;
            currentStation = 1;
        }
    }

    else if (mode === "rest") {

        // Etter vanlig pause → alltid arbeid igjen
        mode = "work";
        timeLeft = workTime;
    }

    else if (mode === "roundPause") {

        // Etter runde-pause → arbeid igjen
        mode = "work";
        timeLeft = workTime;
    }

    updateDisplay();
}

</script>

</body>
</html>
