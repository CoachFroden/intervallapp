<!DOCTYPE html>
<html lang="no">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intervall App</title>
<link rel="manifest" href="manifest.json">
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js');
}
</script>


<style>
/* --- VINTERBAKGRUNN --- */
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(180deg, #0b1e3d, #0d335f, #1a4c7e);
    color: white;
    text-align: center;
    padding: 20px;
    margin: 0;
    overflow: hidden;
}

/* --- BLÅ GLOWS --- */
.glow, h1, h2, label, #sub, #display {
    text-shadow: 0 0 8px #7cc9ff, 0 0 16px #7cc9ff;
}

/* --- TITLER --- */
h1 { margin-bottom: 5px; }
.winter-title {
    margin-top: -5px;
    font-size: 24px;
    opacity: 0.9;
}

/* --- DISPLAY (NEDTELLING) --- */
#display {
    font-size: 70px;
    margin-top: 20px;
}
#sub {
    font-size: 26px;
    opacity: 0.8;
    margin-bottom: 20px;
}

/* --- CONTROL-PANEL (FROSTET GLASS) --- */
.controls {
    margin-top: 20px;
    text-align: left;
    display: inline-block;
    padding: 15px;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.10);
    backdrop-filter: blur(4px);
    border: 1px solid rgba(255,255,255,0.15);
    box-shadow: 0 0 12px rgba(100,180,255,0.3);
}

/* --- INPUT-RADER --- */
.controls .row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 260px;
    margin: 10px auto;
}

/* --- TEKST / INPUTS --- */
.controls label {
    font-size: 20px;
    color: white;
}
.controls input {
    font-size: 20px;
    width: 90px;
    padding: 4px;
    text-align: center;
    border-radius: 6px;
}

/* --- KNAPPER --- */
button {
    background: #28a745;
    color: white;
    border: none;
    padding: 18px 40px;
    margin: 10px;
    font-size: 24px;
    border-radius: 12px;
    cursor: pointer;
    width: 80%;
}
button.stop {
    background: #dc3545;
}

/* --- BLINK 3-2-1 --- */
.blink {
    animation: blinkEffect 0.25s linear;
}
@keyframes blinkEffect {
    from { filter: brightness(1); }
    to   { filter: brightness(2.2); }
}

/* SNØFALL CANVAS */
#snow {
    position: fixed;
    top: 0;
    left: 0;
    z-index: -1;
}
</style>
</head>

<body>

<h1 class="glow">Intervall App</h1>
<h2 class="glow winter-title">Vintertrening 2026 ❄️</h2>

<div class="controls">
    <div class="row">
        <label>Arbeid (sek):</label>
        <input id="workInput" type="number" value="30">
    </div>

    <div class="row">
        <label>Pause (sek):</label>
        <input id="restInput" type="number" value="15">
    </div>

    <div class="row">
        <label>Stasjoner:</label>
        <input id="stationsInput" type="number" value="10">
    </div>

    <div class="row">
        <label>Runder:</label>
        <input id="roundsInput" type="number" value="2">
    </div>

    <div class="row">
        <label>Rundepause (sek):</label>
        <input id="roundPauseInput" type="number" value="90">
    </div>
</div>

<div id="display">00</div>
<div id="sub">Trykk start</div>

<button onclick="startTimer()">Start</button>
<button class="stop" onclick="stopTimer()">Stopp</button>

<!-- LYDER -->
<audio id="beep" src="beep.mp3"></audio>
<audio id="finalBeep" src="langbeep.mp3"></audio>

<script>
let work, rest, stations, rounds, roundPause;
let currentStation = 1;
let currentRound = 1;
let timeLeft;
let mode = "idle";
let timer = null;

function startTimer() {
    work = Number(document.getElementById("workInput").value);
    rest = Number(document.getElementById("restInput").value);
    stations = Number(document.getElementById("stationsInput").value);
    rounds = Number(document.getElementById("roundsInput").value);
    roundPause = Number(document.getElementById("roundPauseInput").value);

    currentRound = 1;
    currentStation = 1;

    mode = "work";
    timeLeft = work;
    updateDisplay();
    timer = setInterval(tick, 1000);
}

function stopTimer() {
    clearInterval(timer);
    timer = null;
    mode = "idle";
    document.getElementById("display").innerText = "00";
    document.getElementById("sub").innerText = "Stoppet";
}

function tick() {
    const shortBeep = document.getElementById("beep");
    const longBeep = document.getElementById("finalBeep");

    // 3–2–1 blink + pip
    if (timeLeft === 3 || timeLeft === 2) {
        document.body.classList.add("blink");
        shortBeep.currentTime = 0;
        shortBeep.play();
        setTimeout(() => document.body.classList.remove("blink"), 300);
    }

    if (timeLeft === 1) {
        document.body.classList.add("blink");
        longBeep.currentTime = 0;
        longBeep.play();
        setTimeout(() => document.body.classList.remove("blink"), 300);
    }

    timeLeft--;
    updateDisplay();

    if (timeLeft === 0) {

        if (mode === "work") {
            mode = "rest";
            timeLeft = rest;

        } else if (mode === "rest") {
            currentStation++;

            if (currentStation > stations) {
                currentRound++;

                if (currentRound > rounds) {
                    finish();
                    return;
                }

                mode = "roundPause";
                timeLeft = roundPause;
                currentStation = 1;

            } else {
                mode = "work";
                timeLeft = work;
            }

        } else if (mode === "roundPause") {
            mode = "work";
            timeLeft = work;
        }
    }
}

function finish() {
    clearInterval(timer);
    timer = null;
    mode = "done";
    document.getElementById("finalBeep").play();
    document.getElementById("display").innerText = "Ferdig!";
    document.getElementById("sub").innerText = "";
}

function updateDisplay() {
    if (mode === "idle") return;

    document.getElementById("display").innerText = timeLeft;

    let text = "";
    if (mode === "work") text = "Arbeid";
    if (mode === "rest") text = "Pause";
    if (mode === "roundPause") text = "Runde-pause";

    document.getElementById("sub").innerHTML =
        `${text}<br>Runde ${currentRound}/${rounds} | Stasjon ${currentStation}/${stations}`;
}
</script>

<!-- SNØFALL -->
<canvas id="snow"></canvas>
<script>
const canvas = document.getElementById('snow');
const ctx = canvas.getContext('2d');
let flakes = [];

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resize();
window.onresize = resize;

function createFlake() {
    return {
        x: Math.random() * canvas.width,
        y: -10,
        size: Math.random() * 4 + 1,
        speed: Math.random() * 1 + 0.5,
        drift: Math.random() * 1 - 0.5
    };
}

function updateSnow() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (flakes.length < 150) {
        flakes.push(createFlake());
    }

    flakes.forEach((f, i) => {
        f.y += f.speed;
        f.x += f.drift;

        ctx.fillStyle = "rgba(255,255,255,0.8)";
        ctx.beginPath();
        ctx.arc(f.x, f.y, f.size, 0, Math.PI * 2);
        ctx.fill();

        if (f.y > canvas.height) {
            flakes[i] = createFlake();
        }
    });

    requestAnimationFrame(updateSnow);
}
updateSnow();
</script>

</body>
</html>
